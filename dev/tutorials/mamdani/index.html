<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Build a Mamdani inference system · FuzzyLogic.jl</title><meta name="title" content="Build a Mamdani inference system · FuzzyLogic.jl"/><meta property="og:title" content="Build a Mamdani inference system · FuzzyLogic.jl"/><meta property="twitter:title" content="Build a Mamdani inference system · FuzzyLogic.jl"/><meta name="description" content="Documentation for FuzzyLogic.jl."/><meta property="og:description" content="Documentation for FuzzyLogic.jl."/><meta property="twitter:description" content="Documentation for FuzzyLogic.jl."/><meta property="og:url" content="https://lucaferranti.github.io/FuzzyLogic.jl/tutorials/mamdani/"/><meta property="twitter:url" content="https://lucaferranti.github.io/FuzzyLogic.jl/tutorials/mamdani/"/><link rel="canonical" href="https://lucaferranti.github.io/FuzzyLogic.jl/tutorials/mamdani/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="FuzzyLogic.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">FuzzyLogic.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Build a Mamdani inference system</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Building-the-inference-system"><span>Building the inference system</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li><li><a class="tocitem" href="#Inference"><span>Inference</span></a></li><li><a class="tocitem" href="#Code-generation"><span>Code generation</span></a></li></ul></li><li><a class="tocitem" href="../sugeno/">Build a Sugeno inference system</a></li><li><a class="tocitem" href="../type2/">Build a type-2 inference system</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Applications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../applications/edge_detector/">Edge detection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Inference system API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/fis/">Types</a></li><li><a class="tocitem" href="../../api/logical/">Logical connectives</a></li><li><a class="tocitem" href="../../api/aggregation/">Aggregation methods</a></li><li><a class="tocitem" href="../../api/defuzzification/">Defuzzification methods</a></li></ul></li><li><a class="tocitem" href="../../api/memberships/">Membership functions</a></li><li><a class="tocitem" href="../../api/readwrite/">Reading/Writing</a></li><li><a class="tocitem" href="../../api/genfis/">Learning fuzzy models</a></li><li><a class="tocitem" href="../../api/plotting/">Plotting</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributor&#39;s Guide</a></li><li><a class="tocitem" href="../../changelog/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Build a Mamdani inference system</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Build a Mamdani inference system</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lucaferranti/FuzzyLogic.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lucaferranti/FuzzyLogic.jl/blob/main/docs/src/literate/tutorials/mamdani.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Build-a-Mamdani-inference-system"><a class="docs-heading-anchor" href="#Build-a-Mamdani-inference-system">Build a Mamdani inference system</a><a id="Build-a-Mamdani-inference-system-1"></a><a class="docs-heading-anchor-permalink" href="#Build-a-Mamdani-inference-system" title="Permalink"></a></h1><p>This tutorial gives a general overiew of FuzzyLogic.jl basic functionalities by showing how to implement and use a type-1 Mamdani inference system.</p><div class="admonition is-success"><header class="admonition-header">Try it yourself!</header><div class="admonition-body"><p>Read this as Jupyter notebook <a href="https://nbviewer.jupyter.org/github/lucaferranti/FuzzyLogic.jl/blob/gh-pages/dev/notebooks/mamdani.ipynb">here</a></p></div></div><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>To follow the tutorial, you should have <a href="https://julialang.org/downloads/">installed Julia</a>.</p><p>Next, you can install <code>FuzzyLogic.jl</code> with</p><pre><code class="language-julia hljs">using Pkg; Pkg.add(&quot;FuzzyLogic&quot;)</code></pre><h2 id="Building-the-inference-system"><a class="docs-heading-anchor" href="#Building-the-inference-system">Building the inference system</a><a id="Building-the-inference-system-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-inference-system" title="Permalink"></a></h2><p>First, we need to load the library.</p><pre><code class="language-julia hljs">using FuzzyLogic</code></pre><p>The Mamdani inference system can be constructed with the <a href="../../api/readwrite/#FuzzyLogic.@mamfis"><code>@mamfis</code></a> macro. We will first give a full example and then explain every step.</p><pre><code class="language-julia hljs">fis = @mamfis function tipper(service, food)::tip
    service := begin
        domain = 0:10
        poor = GaussianMF(0.0, 1.5)
        good = GaussianMF(5.0, 1.5)
        excellent = GaussianMF(10.0, 1.5)
    end

    food := begin
        domain = 0:10
        rancid = TrapezoidalMF(-2, 0, 1, 3)
        delicious = TrapezoidalMF(7, 9, 10, 12)
    end

    tip := begin
        domain = 0:30
        cheap = TriangularMF(0, 5, 10)
        average = TriangularMF(10, 15, 20)
        generous = TriangularMF(20, 25, 30)
    end

    and = ProdAnd
    or = ProbSumOr
    implication = ProdImplication

    service == poor || food == rancid --&gt; tip == cheap
    service == good --&gt; tip == average
    service == excellent || food == delicious --&gt; tip == generous

    aggregator = ProbSumAggregator
    defuzzifier = CentroidDefuzzifier
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">tipper

Inputs:
-------
service ∈ [0, 10] with membership functions:
    poor = GaussianMF(0.0, 1.5)
    good = GaussianMF(5.0, 1.5)
    excellent = GaussianMF(10.0, 1.5)

food ∈ [0, 10] with membership functions:
    rancid = TrapezoidalMF(-2, 0, 1, 3)
    delicious = TrapezoidalMF(7, 9, 10, 12)


Outputs:
--------
tip ∈ [0, 30] with membership functions:
    cheap = TriangularMF(0, 5, 10)
    average = TriangularMF(10, 15, 20)
    generous = TriangularMF(20, 25, 30)


Inference rules:
----------------
(service is poor ∨ food is rancid) --&gt; tip is cheap
service is good --&gt; tip is average
(service is excellent ∨ food is delicious) --&gt; tip is generous


Settings:
---------
- ProdAnd()
- ProbSumOr()
- ProdImplication()
- ProbSumAggregator()
- CentroidDefuzzifier(100)
</code></pre><p>As you can see, defining a fuzzy inference system with <code>@mamfis</code> looks a lot like writing Julia code. Let us now take a closer look at the components. The first line</p><pre><code class="language-julia hljs">function tipper(service, food)::tip</code></pre><p>specifies the basic properties of the system, particularly</p><ul><li>the function name <code>tipper</code> will be the name of the system</li><li>the input arguments <code>service, food</code> represent the input variables of the system</li><li>the output type annotation <code>::tip</code> represents the output variable of the system. If the system has multiple outputs, they should be enclosed in braces, i.e. <code>::{tip1, tip2}</code></li></ul><p>The next block is the variable specifications block, identified by the <code>:=</code> operator. This block is used to specify the domain and membership functions of a variable, for example</p><pre><code class="language-julia hljs">service := begin
    domain = 0:10
    poor = GaussianMF(0.0, 1.5)
    good = GaussianMF(5.0, 1.5)
    excellent = GaussianMF(10.0, 1.5)
end</code></pre><p>The order of the statements inside the <code>begin ... end</code> block is irrelevant.</p><ul><li><p>The line <code>domain = 0:10</code> sets the domain of the variable to the interval <span>$[0, 10]$</span>. Note that setting the domain is required</p></li><li><p>The other lines specify the membership functions of the variable.</p></li></ul><p>For example, <code>poor = GaussianMF(0.0, 1.5)</code> means that the variable has a Gaussian membership function called <code>poor</code> with mean <span>$0.0$</span> and stanrdard devisation <span>$1.5$</span>. A complete list of supported dmembership functions and their parameters can be found in the <a href="../../api/memberships/#Membership-functions">Membership functions</a> section of the API documentation.</p><p>Next, we describe rule blocks. A fuzzy relation such as <code>service is poor</code> is described with the <code>==</code> operator, for example <code>service == poor</code>. The <em>premise</em> i.e. left-hand side, of the rule can be any logical proposition connecting fuzzy relations with the <code>&amp;&amp;</code> (AND) and <code>||</code> (OR) operators. The <em>consequence</em> i.e. right-hand side, of the rule is a fuzzy relation for the output variable. Premise and consequence are connected with the <code>--&gt;</code> operator. For example, the rule</p><pre><code class="language-julia hljs">service == poor || food == rancid --&gt; tip == cheap</code></pre><p>reads <em>If the service is poor or the food is rancid, then the tip is cheap</em>.</p><p>Note that in the premise can be any logical proposition, you can have both <code>&amp;&amp;</code> and  <code>||</code> connectives and you can also have nested propositions. For example, the following is a valid rule</p><pre><code class="language-julia hljs">service == poor || food = rancid &amp;&amp; service == good</code></pre><p>The connectives follow Julia precedence rules, so <code>&amp;&amp;</code> binds stronger than <code>||</code>.</p><p>If you have multiple outputs, then the consequence should be a tuple, for example</p><pre><code class="language-julia hljs">service == poor || food == rancid --&gt; (tip1 == cheap, tip2 == cheap)</code></pre><p>Finally, assignment lines like</p><pre><code class="language-julia hljs">and = ProdAnd</code></pre><p>are used to set the settings of the inference system. For a Mamdani inference system, the following settings are available</p><ul><li><code>and</code>: algorithm to evaluate <code>&amp;&amp;</code>. Must be one of the available <a href="../../api/logical/#Conjuction-methods">Conjuction methods</a>. Default <a href="../../api/logical/#MinAnd"><code>MinAnd</code></a>.</li><li><code>or</code>: algorithm to evaluate <code>||</code>. Must be one of the available <a href="../../api/logical/#Disjunction-methods">Disjunction methods</a>. Default <a href="../../api/logical/#MaxOr"><code>MaxOr</code></a></li><li><code>implication</code>: algorithm to evalute <code>--&gt;</code>. Must be one of the available <a href="../../api/logical/#Implication-methods">Implication methods</a>. Default <a href="../../api/logical/#MinImplication"><code>MinImplication</code></a>.</li><li><code>aggregato</code>: algorithm to perform outputs aggregation. Must be one of the available <a href="../../api/aggregation/#Aggregation-methods">Aggregation methods</a>. Default <a href="../../api/aggregation/#FuzzyLogic.MaxAggregator"><code>MaxAggregator</code></a>.</li><li><code>defuzzifier</code>: algorithm to perform defuzzification. Must be one of the available <a href="../../api/defuzzification/#Defuzzification-methods">Defuzzification methods</a>. Default <a href="../../api/defuzzification/#FuzzyLogic.CentroidDefuzzifier"><code>CentroidDefuzzifier</code></a>.</li></ul><p>If one of the above settings is not specified, the corresponding default value is used.</p><p>Some of the above settings may have internal parameters. For example, <a href="../../api/defuzzification/#FuzzyLogic.CentroidDefuzzifier"><code>CentroidDefuzzifier</code></a> has an integer parameter <code>N</code>, the number of points used to perform numerical integration. If the parameter is not specified, as in <code>defuzzifier = CentroidDefuzzifier</code>, then the default value for <code>N</code> can be used. This parameter can be overwritten with custom values, for example</p><pre><code class="language-julia hljs">defuzzifier = CentroidDefuzzifier(50)</code></pre><p>will use <span>$50$</span> as value of <code>N</code> instead of the default one (<span>$100$</span> in this case).</p><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>The library offers tools to visualize your fuzzy inference system. This requires installing and importing the <code>Plots.jl</code> library.</p><pre><code class="language-julia hljs">using Plots</code></pre><p>The membership functions of a given variable can be plotted by calling <code>plot(fis, varname)</code>, where <code>fis</code> is the inference system you created and <code>varname</code> is the name of the variable you want to visualize, given as a symbol. For example,</p><pre><code class="language-julia hljs">plot(fis, :service)</code></pre><img src="90c433ee.svg" alt="Example block output"/><p>Giving only the inference system object to <code>plot</code> will plot the inference rules, one per line.</p><pre><code class="language-julia hljs">plot(fis)</code></pre><img src="ffe6c483.svg" alt="Example block output"/><p>If the FIS has at most 2 inputs, we can plot the generating surface of the system using the function <a href="../../api/plotting/#FuzzyLogic.gensurf"><code>gensurf</code></a>. This is a surface visualizing how the output changes as a function of the input.</p><pre><code class="language-julia hljs">gensurf(fis)</code></pre><img src="6c47cc3a.svg" alt="Example block output"/><h2 id="Inference"><a class="docs-heading-anchor" href="#Inference">Inference</a><a id="Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Inference" title="Permalink"></a></h2><p>To perform inference, you can call the above constructed inference system as a function, passing th input values as parameters. Note that the system does not accept positional arguments, but inputs should be passed as name-value pairs. For example</p><pre><code class="language-julia hljs">res = fis(service = 2, food = 3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Dictionaries.Dictionary{Symbol, Float64}
 :tip │ 7.480430420665251</code></pre><p>The result is a Dictionary containing the output value corresponding to each output variable. The value of a specific output variable can be extracted using the variable name as key.</p><pre><code class="language-julia hljs">res[:tip]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">7.480430420665251</code></pre><h2 id="Code-generation"><a class="docs-heading-anchor" href="#Code-generation">Code generation</a><a id="Code-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Code-generation" title="Permalink"></a></h2><p>The model can be compiled to native Julia code using the <a href="../../api/readwrite/#FuzzyLogic.compilefis"><code>compilefis</code></a> function. This produces optimized Julia code independent of the library, that can be executed as stand-alone function.</p><pre><code class="language-julia hljs">fis_ex = compilefis(fis)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">:(function tipper(service, food)
      poor = exp(-((service - 0.0) ^ 2) / 4.5)
      good = exp(-((service - 5.0) ^ 2) / 4.5)
      excellent = exp(-((service - 10.0) ^ 2) / 4.5)
      rancid = max(min((food - -2) / 2, 1, (3 - food) / 2), 0)
      delicious = max(min((food - 7) / 2, 1, (12 - food) / 2), 0)
      ant1 = (poor + rancid) - poor * rancid
      ant2 = good
      ant3 = (excellent + delicious) - excellent * delicious
      tip_agg = collect(LinRange{Float64}(0.0, 30.0, 101))
      @inbounds for (i, x) = enumerate(tip_agg)
              cheap = max(min((x - 0) / 5, (10 - x) / 5), 0)
              average = max(min((x - 10) / 5, (20 - x) / 5), 0)
              generous = max(min((x - 20) / 5, (30 - x) / 5), 0)
              tip_agg[i] = (((ant1 * cheap + ant2 * average) - (ant1 * cheap) * (ant2 * average)) + ant3 * generous) - ((ant1 * cheap + ant2 * average) - (ant1 * cheap) * (ant2 * average)) * (ant3 * generous)
          end
      tip = ((2 * sum((mfi * xi for (mfi, xi) = zip(tip_agg, LinRange{Float64}(0.0, 30.0, 101)))) - first(tip_agg) * 0) - last(tip_agg) * 30) / ((2 * sum(tip_agg) - first(tip_agg)) - last(tip_agg))
      return tip
  end)</code></pre><p>The new expression can now be evaluated as normal Julia code. Notice that the generated function uses positional arguments.</p><pre><code class="language-julia hljs">eval(fis_ex)
tipper(2, 3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">7.480430420665253</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../sugeno/">Build a Sugeno inference system »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 19 September 2024 18:30">Thursday 19 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
